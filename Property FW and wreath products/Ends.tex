%!TEX root = Property_FW_and_wreath_products.tex
\todo[inline]{Ajouter les petits lemmes sur les sous-groupes}
For finitely generated groups, the point \ref{C:FW_Schrei} of the Proposition \ref{P:charact_FW} gives us a nice geometrical characteriation of the property FW. We will present more explicit and constructive proofs of the Proposition \ref{Prop:Median} in this contex. 

We will begin by a short recall on Schreier graph. \todo{Utile de redéfinir les Schreier ?}.
%
\begin{defn}
Let $G$ be a finitely generated group, $H$ a subgroup of $G$ and $S$ a finite generating set. The \emph{Cayley graph} of $G$ with respect to $H$ and $S$ is the graph where the vertex are the cosets $gH$ and two vertices $gH$ and $g'H$ are adjacent if there exists a generator $s$ such that $g'H = sgH$.
\end{defn}
%
If a group $G$ acts on a set $X$, we can define the graph of the action of $G$ on the orbit of an element $x$ as the graph where the vertex are the element of the orbit of $x$ and two vertices are adjacent if they are linked by the action of a generator. The Schreier graphs are intimitely linked with group actions by the classical following lemma.
%
%
\begin{lem}\label{L:gen_wreath}
Let $G$ be a finitely generated groups, $S$ be a finite generating set and $X$ be a $G$-set. Then for each element $x$ of $X$, the graph of the action of $G$ on the orbit of $x$ is isomorphic to the Schreier graph $\Sch(G,\stab(x),S)$.
\end{lem}
%
%
In fact all the Schreier graph can be viewed as graphs of actions, by considering the action of $G$ on this Schreier graph.

As we want to work with finitely generated groupm the folowing lemma is useful.
%
%
\begin{lem}\label{L:wreath_fg}
Let $G$ and $H$ be groups and $X$ be a $H$-set. The wreath product $G \wr_X H$ is finitely generated if and only if $G$ and $H$ are finitely generated and if the number of orbits of the action $H \actsGroup X$ is finite.
\end{lem}
%
\begin{proof}
Suppose that $G$ and $H$ are finitely generated and that the number of orbits is finite. Let $S$ be a finite generating set of $G$, $S'$ a finite generating set of $H$ and $\{x_0, \ldots, x_n \}$ a representative system of the orbits. For $s$ in $S$ and $x$ in $X$, we define $\delta_x^s$ as
%
\begin{equation*}
\delta_{x}^s (y) = \begin{cases} e_G & y \neq x \\ s 	& y = x \end{cases}.
\end{equation*}
%
It is straightforward to prove that the set 
\begin{equation*}
\left\{(\delta_x^s,e_H) : s \in S, x \in \{x_0,\ldots,x_n\} \right\} \cup \left\{ (0,s') : s' \in S' \right\}
\end{equation*}
is a finite generating set of $G \wr_X H$, where $0(x) = e_g$ for all $x$ in $X$.

If $G$ or $H$ are not finitely generated, it is clear that $G \wr_X H$ is not either. Suppose that there are infinitely many orbits. If $\phi$ is a function of $\bigoplus_X G$ whose support is include in $X_1 \sqcup \ldots X_n$, then for every $h$ in $H$, the support of $h.\phi$ is also contain in  $X_1 \sqcup \ldots X_n$, where $X = X_1 \sqcup X_2 \sqcup \ldots$ is a decomposition on disjoint orbits. As all the elements of $\bigoplus_X G$ have finite support, it is necessary to have infintely many such element to generate the whole group $G \wr_X H$.
\end{proof}
%
%
\begin{lem}\label{Lemma:Semidirect_ends}
Let $G = N \rtimes H$ be a finitely generated semidirect product. Then
\begin{enumerate}
\item If $G$ has FW, then so does $H$.
\item If both $N$ and $H$ have FW, then $G$ also has FW.
\end{enumerate}
\end{lem}
%
\begin{proof}
It is well known that if $N$ is generated by a set $S$ and $H$ by a set $S'$, then $G$ is generated by $S \cup S'$.

Suppose that $H$ does not have the property FW. There exists a Schreier graph $X$ of $H$ with more than one end. The group $G$ acts on $X$ via 
\begin{equation*}
(n,h).x = hx 
\end{equation*}
for a vertex $x$ of $X$. This action $G \actsGroup \Gamma$ is transitive because the action $H \actsGroup \Gamma$ is. The graph of the action $G \actsGroup X$ is exactly the graph $X$ with some additional loops for generators of $S'$. As adding loops does not change the number of ends, this Schreier graph has more than one ends and the $G$ does not have the property FW.

Suppose now that $N$ and $H$ have the property FW. We want to show that every Schreier graphs of $G$ have at most one end. Let $X$ be an infinite Schreier graph of $G$ with respect to the generating set $S \cup S'$. The groups $N$ and $H$ acts on $X$ via
\begin{align*}
n.x &= (n,0)x \\
h.x &= (0,h)x
\end{align*}
for a vertex $x$ of $X$. For each such vertex $x$ we define $X_x^H$ (and respectively $X_x^N$) the Schreier graph obtained from the action of $N$ (resp. $H$) on the orbit of $x$. This is subgraphs of $X$. As $N$ and $H$ have the property FW, the graphs $X_x^H$ and $X_x^N$ are finite or one-ended. We want to prove that in this case, $X$ has at most one end. 

Let $K$ be a finite set of vertices of $X$. We will construct a path between every pair of vertices which are in infinite connected components. First, for every $x$ in $K$, if $X_x^H$ is finite, we add all the vertices of this subgraph in $K$. Adding vertices in $K$ can not decrease the number of ends. Moreover we add a finite number of vertices in $K$. With this new set $K$, we have that for every $x$ in $X \setminus K$, the subgraph $X_x^H \setminus K$ is equal to $X_x^H$ or has one end. 

Let $x$ and $y$ be two vertices of an infinite component of $X \setminus K$. The action of $G$ on $X$ is transitive, then there exists an element $(n,h)$ of $N \rtimes H$ such that $(n,h).x = y$. We choose a vertex $z$ in $X_x^H$ such that $X_z^N$ does not contain an element of $K$ or is one-ended and such that $z'=(h'h^{-1}.n,0)z$ is not in $K$, where $h'$ is an element of $H$ and $h'.x = z$. Such an element exists as $X_x^H$ and $X_y^H$ are infinite and $K$ is finite. The vertex $z'$ is in $X_y^H$ because
\begin{equation*}
(0,hh'^{-1}) z' = (0,hh'^{-1})(h'h^{-1}.n,0)(0,h')x = (n,h)x = y.
\end{equation*}

We will construct a path on $X \setminus K$ between $x$ and $y$ as follows. The subgraph $X_x^H$ is one-ended, then there exists a path between $x$ and $z$. In the same way, $X_z^N$ has one end or has no vertex in $K$, then there is a path which join $z$ and $z'$. There exists a path between $z'$ and $y$ in $X_y^H$ which is one-ended. Then $x$ and $y$ are path-connected and then $X$ has one end. We proved that all the Schreier graph of $G$
\begin{figure}[H]\centering
\scalebox{0.7}{
\input{graphes/path_semidirect_ends.tex}}
\caption{The path between $x$ and $y$.}
\end{figure}\end{proof}
%geo

%
\begin{cor}\label{Cor:Wreath_ends}
Let $G$ and $H$ be two finitely generated groups and $X$ a $H$-set such that the number of orbits is finite. Then,
\begin{enumerate}
\item
If $G\wr_X H$ has the property FW, then so does $H$.
\item
If $G$ and $H$ have the property FW and $X$ is finite, then $G\wr_X H$ has FW.
\end{enumerate}
\end{cor}
%
%
The proof is an iterated application of the previous lemma.
%
%
\begin{lem}\label{Lem:Wreath_groups_ends}
Let $\Gamma = G \wr_X H$ be a finitely generated wreath product and $G$ be a non-trivial group. If $\Gamma$ has the property FW, then 
\begin{enumerate}
\item $G$ has the property $FW$.
\item $X$ is finite.
\end{enumerate}
%
\begin{proof}
We will prove the contrapositives. The idea is to construct, for each of the three cases, a Schreier graph of $\Gamma$ with more than one end by using actions of $\Gamma$. We will suppose, as in the Lemma~\ref{L:gen_wreath} that $G = \gen{S}$, $H = \gen{S'}$ and if there is no more condition $x_0$ is an arbitrary point of $X$.

Suppose that $X$ is an infinite set. There exsits an infinite orbit. Ideed, as the $\Gamma$ is finitely generated, we know by the Lemma \ref{L:wreath_fg} that the number of orbits of the action $H \actsGroup X$ is finite. Let $X'$ be such an infinite orbit and $x_0$ an element of $X'$. We define $Y = G \times X'$. The group $\Gamma$ acts on $Y$ via
\begin{equation*}
(\phi,h) \cdot (g,x) = (\phi(hx)g, hx)
\end{equation*}
for $(\phi,h)$ in $\Gamma$ and $(g,x)$ in $Y$. The action is transitive. Indeed, let $(g_1,x_1)$ and $(g_2,x_2)$ be two elements of $Y$. By transitivity of the action of $H$ on $X'$, there exists $h$ in $H$ such that $hx_1 = x_2$ and $\phi$ in $\bigoplus_X G$ such that $\phi(hx_1) = g_2g_1^{-1}$. Then, 
\begin{equation*}
(\phi,h) (g_1,x_1) = (\phi(h x_1) g, h x_1) = (g_2,x_2).
\end{equation*}
The graph of the action of $\Gamma$ on $Y$ is isomorphic to the Schreier graph $\Sch(\Gamma, \stab(e_G,x_0), \S)$. We decompose the graph into leaves of the form $Y_g = \{ g \} \times X'$. There are two types of edges in this graph which are coming from the two sets of generators. The first one, of the form $(0,s')$, give us on each leaf a copy of the graph of the action $H \actsGroup X'$. Indeed,
\begin{equation*}
(0,s')(g,x) = (g, s'x).
\end{equation*}
The second one, of the form $(\delta_{x_0}^s,0)$, give us loops everywhere excepting on vertices of the form $(g,x_0)$. By direct computation, we see that the vertices $(g,x_0)$ and $(sg,x_0)$ connect the leaves $Y_g$ and $Y_{sg}$, 
\begin{equation*}
(\delta_{x_0}^s,0)(g,x) = 
\begin{cases}
(g,x) & x \neq x_0 \\
(sg, x) & x = x_0
\end{cases}
\end{equation*}
%
\begin{figure}[H]\centering
\scalebox{0.7}{
\input{graphes/leaves_structure_schreier.tex}}
\caption{The leaf structure of the graph of the action $\Gamma \actsGroup Y$.}
\end{figure}
%
If we remove a vertex $(g,x_0)$ we disconnect the leaf $Y_g$ to the graph. As $X'$ is infinite, the number of ends is strictly greater than 1.

Suppose that $G$ does not have the property FW. There exists a subgroup $K$ of $G$ such that $\Sch(G,K,S)$ has more than one end. The choice of $x_0$ is arbitrary in this case. The group $\Gamma$ acts on $G/K \times X'$ via  
\begin{equation*}
(\phi,h)(gK,x) = (\phi(hx) gK, hx).
\end{equation*}
where $X'$ is the orbit of $x_0$. As above, the action is transitive and the graph of this action is isomorphic to a Schreier graph. We decompose this graph into leaves in the same way. Now we look at the subgraph made up of vertices $(g,x_0)$ and edges $(\delta_{x_0}^s,0)$ and we remark that it is isomorphic the Schreier graph $\Sch(G,K,S)$ which has more than one end. Then our graph has also more than one end.
\end{proof}
\end{lem}
%
%
The following proposition is a direct application of Corollary \ref{Cor:Wreath_ends} and Lemma \ref{Lem:Wreath_groups_ends}.
%
%
\begin{prop}
Let $G$ be a non trivial finitely generated group, $H$ be a finitely generated group and $X$ a set on which $H$ acts with a finite number of orbit. The wreath product $G \wr_X H$ has the property FW if and only if $G$ and $H$ have the property FW and $X$ is finite.
\end{prop}
%
%