%!TEX root = ends.tex
%
%
%
%
%
%
%
%
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%    Section : Proof of the main result    %%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Proof of the main result}
\label{Section:Proof}
%
%
%
%
%
This section is devoted to the proof of Theorem~\ref{Thm:Main}. This proof is split into two parts: Lemma \ref{Lemma:Semidirect_ends} and its Corollary \ref{Cor:Wreath_ends} and Lemma \ref{Lem:Wreath_groups_ends}.
We then conclude by a result on finite index subgroups.

%\todo[inline]{Est-ce qu'on veut rajouter que si $H$ est un sous-groupe d'indice fini de $G$, alors $G$ a FW ssi $H$ a FW ? C'est le seul petit résultat qui fait sens à prouver. En effet, ceux sur les sommes directes font intervenir des groupes qui ne sont pas de type fini.}

We begin by a result on semi-direct products.
%
%
\begin{lem}\label{Lemma:Semidirect_ends}
Let $N$ and $H$ be two finitely generated groups and $N\rtimes H$ a semi-direct product.
Then
\begin{enumerate}
\item If $N\rtimes H$ has FW, then so does $H$,
\item If both $N$ and $H$ have FW, then $G$ also has FW.
\end{enumerate}
\end{lem}
%
%
\begin{proof}
Let $S$, respectively $T$, denotes a finite generating set of $N$, respectively $H$.
It is well known that $G=N\rtimes H$ is finitely generated by $U=(S\times\{1\}) \cup(\{1\}\times T)$.

Suppose that $H$ does not have property FW. Then there exists a Schreier graph $\Gamma=\Sch(H,K;T)$ of $H$ with more than one end. The group $G\coloneqq N\rtimes H$ acts on $\Gamma$ via $(n,h).x \coloneqq h.x$.
Since $H$ acts transitively on $\Gamma$, so does $G$.
In fact, the graph of the action $G$ on the vertices of $\Gamma$ is isomorphic to the graph $\Gamma$ with some additional loops for generators in $S\times\{1\}$. As adding loops does not change the number of ends, this Schreier graph has more than one end and therefore $G$ does not have property FW.

Suppose now that both $N$ and $H$ have property FW. We want to show that every Schreier graphs of $G$ have at most one end. If they are all finite, then there is nothing to prove (and $G$ is finite). So let $\Gamma$ be an infinite Schreier graph of $G$ with respect to the generating set $U$. The groups $N$ and $H$ acts on $\Gamma$ by restriction of the action of $G$. That is, $n.x = (n,1).x$ and $h.x = (1,h).x$ for $x$ a vertex of $\Gamma$.
For each vertex $x$ we define $\Gamma_x^H$ (and respectively $\Gamma_x^N$) as the Schreier graph obtained from the action of $H$ (respectively $N$) on the $H$-orbit (respectively $N$-orbit) of $x$. These are subgraphs of $\Gamma$. As $N$ and $H$ have property FW, the graphs $\Gamma_x^H$ and $\Gamma_x^N$ are either finite or one-ended. We want to prove that in this case $\Gamma$ has exactly one end. 

Let $K$ be a finite set of vertices of $\Gamma$.
If $x$ is in $K$ and $\Gamma_x^H$ is finite, add all vertices of $\Gamma_x^H$ to $K$.
By doing so for every $x$ in $K$, we obtain a new finite set $K\subset K'$ of vertices of $\Gamma$.
We will show that $\Gamma\setminus K'$ has only one infinite connected component.
By definition of $K'$, if $x$ is not in $K'$, then either $\Gamma_x^H$ has one end or $\Gamma_x^H$ does not contains vertices in $K'$. 

Let $x$ and $y$ be two vertices, each of them lying in some infinite connected component of $\Gamma\setminus K'$.
We will construct a path from $x$ to $y$ in $\Gamma\setminus K'$ as a concatenation of three smaller paths as follow, see Figure~\ref{Figure:PathSemiDirect}.
First, a path in $\Gamma_x^H\setminus K'$ from $x$ to some $z$, then a path in $\Gamma_z^N\setminus K'$ from $z$ to some $z'\in (\Gamma_z^N\cap \Gamma_y^H)\setminus K'$, and finally a path in $\Gamma_y^H\setminus K'$ from $z'$ to $y$.
In order to finish the proof, it remains to exhibit elements $z$ and $z'$ and the three desired paths.
%
%
\begin{figure}[htbp]\centering
\scalebox{0.7}{
\input{graphes/path_semidirect_ends.tex}}
\caption{The path between $x$ and $y$.}
\label{Figure:PathSemiDirect}
\end{figure}
%
%

The action of $G$ on $\Gamma$ being transitive, there exists an element $(n_0,h_0)$ of $N \rtimes H$ such that $(n_0,h_0).x = y$.
Since $K'$ is finite, the set $\Gamma_x^H\setminus K'$ is infinite.
Moreover, there is infinitely many $z$ in $\Gamma_x^H\setminus K'$ such that either $\Gamma_z^N$ is one-ended or $\Gamma_z^N$ does not intersect $K'$.
For such a $z$ there exists $h$ such that $(1,h).x=z$.
Now, the vertex $z'\coloneqq(hh_0^{-1}n_0,h).x$ is both equal to $(hh_0^{-1}.n_0,1)(1,h_0).x=(hh_0^{-1}.n_0,1).z$ and to $(1,hh_0^{-1})(n_0,h_0).x=(1,hh_0^{-1}).y$. That is, $z'$ is in $\Gamma_z^N\cap X_y^H$.
A simple computation show us that the map $z\mapsto z'$ is injective: $z_1'=z_2'$ if and only if $z_1=z_2$.
Since $K'$ is finite, there is only finitely many $z'$ in $K'$ and hence there is infinitely many $z\in \Gamma_x^H$ such that both $z$ and $z'$ are not in $K'$ and either $\Gamma_z^N$ is one-ended or $\Gamma_z^N$ does not intersect $K'$.

In order to finish the proof, observe that the three graphs $\Gamma_x^H$, $\Gamma_y^H$ and $\Gamma_z^N$ are all either one-ended or do not intersect $K'$.
Therefore, there is a path in $\Gamma_x^H\setminus K'$ from $x$ to $z$ as desired, and similarly for the paths from $z$ to $z'$ and $z'$ to $y$.
We just have proved that for any finite $K$ the graph $\Gamma\setminus K$ has only one infinite connected component and therefore that $\Gamma$ is one-ended.
\end{proof}
%
%
As a direct corollary, we have
\begin{cor}
Let $G$ and $H$ be two finitely generated groups. Then $G\times H$ has property FW if and only if both $G$ and $H$ have property FW.
\end{cor}
%
%
By iterating Lemma \ref{Lemma:Semidirect_ends}, we obtain
%
%
\begin{cor}\label{Cor:Wreath_ends}
Let $G$ and $H$ be two finitely generated groups and $X$ a set on which $H$ acts with finitely many orbits. Then,
\begin{enumerate}
\item
If $G\wr_X H$ has property FW, then so does $H$,
\item
If both $G$ and $H$ have property FW and $X$ is finite, then $G\wr_X H$ has property~FW.
\end{enumerate}
\end{cor}
%
%
The following Lemma finishes the proof of Theorem~\ref{Thm:Main}.
%
%
\begin{lem}\label{Lem:Wreath_groups_ends}
Let $G$ and $H$ be two finitely generated groups such that $G\neq \{1\}$ and $H$ acts on some set $X$ with finitely many orbits.
If $G\wr_XH$ has property FW, then 
\begin{enumerate}
\item $G$ has property FW,
\item $X$ is finite.
\end{enumerate}
\end{lem}
%
%
\begin{proof}
We will prove the contrapositives. The idea is to construct, for each of the two cases, a Schreier graph of $G\wr_XH$ with more than one end by exhibiting some well-chosen action of $G\wr_XH$.
We fix some finite generating sets $S$ and $T$ of $G$ and $H$ and let 
\[
	U\coloneqq\setst{(\delta_x^s,1_H)}{s \in S} \cup \setst{(\mathbf 1,t}{t \in T}
\]
be the standard generating set of $G\wr_XH$.
%
%
%
\paragraph{Suppose that $X$ is an infinite set.}
Since $H$ acts on $X$ with finitely many orbits, there exists an infinite orbit $X'$.
Let $x_0$ be an arbitrary vertex of $X'$.
The group $G$ acting on itself by left multiplications, we have the so-called \emph{imprimitive action} of the wreath-product $G\wr_XH$ on $Y\coloneqq G\times X'$:
\[
	(\varphi,h). (g,x) \coloneqq (\varphi(h.x)g, h.x).
\]
Since both $G\curvearrowright G$ and $H\curvearrowright X'$ are transitive, the action $G\wr_XH\curvearrowright Y$ is also transitive. 
Therefore, the orbital Schreier graph of $G\wr_XH\curvearrowright Y$ is isomorphic to the Schreier graph $\Gamma\coloneqq\Sch(G\wr_XH, \stab(1_G,x_0), U)$. We decompose this graph into leaves of the form $Y_g = \{ g \} \times X'$. There are two types of edges in $\Gamma$, which are coming from the two sets of generators, see Figure~\ref{Figure:Leaves}. The first ones, of the form $(\mathbf 1,t)$, give us on each leaf a copy of the orbital Schreier graph of $H \curvearrowright X'$. Indeed,
\[
	(\mathbf 1,t).(g,x) = (g, t.x).
\]
The second ones, of the form $(\delta_{x_0}^s,1)$, give us loops everywhere except on vertices of the form $(g,x_0)$. By direct computation, we see that the vertices $(g,x_0)$ and $(sg,x_0)$ connect the leaves $Y_g$ and $Y_{sg}$, 
\[
	(\delta_{x_0}^s,1).(g,x) = 
		\begin{cases}
		(g,x) & \textnormal{if }x \neq x_0, \\
		(sg, x) & \textnormal{if }x = x_0.
		\end{cases}
\]
%
%
\begin{figure}[htbp]\centering
\scalebox{0.7}{
\input{graphes/leaves_structure_schreier.tex}}
\caption{The leaf structure of the orbital Schreier graph of $G\wr_XH \curvearrowright Y$. Plain edges correspond to generators of the form $(\mathbf 1,t)$ while dotted edges correspond to generators of the form $(\delta_{x_0}^s,1)$.}
\label{Figure:Leaves}
\end{figure}
%
%

If we remove a vertex $(g,x_0)$ we disconnect the leaf $Y_g$ from the rest of $\Gamma$. As $X'$ is infinite each leave is infinite and the number of ends of $\Gamma$ is then at least $\abs{G}\geq 2$. We just proved that if $X$ is infinite the group $G\wr_XH$ does not have property FW.
%
%
%
\paragraph{Suppose now that $G$ does not have property FW.} There exists a subgroup $K$ of $G$ such that $\Sch(G,K,S)$ has more than one end.
Let $x_0$ be any point of $X$ and $X'$ be its orbit under the action of $H$.
We have the imprimitive action of $G\wr_XH$ on $G/K\times X$, which we could restrict to an action on $G/K\times X'$:
\[
	(\varphi,h).(gK,x) = (\varphi(h.x) gK, h.x).
\]
As above, the action is transitive and the orbital Schreier graph of this action is isomorphic to a Schreier graph $\Gamma$. We decompose this graph into leaves in the same way. Now we look at the subgraph made up of vertices $(g,x_0)$ and edges $(\delta_{x_0}^s,1)$ and we remark that it is isomorphic to the Schreier graph $\Sch(G,K,S)$ which has more than one end. Then $\Gamma$ has also more than one end, which finishes the proof.
\end{proof}
%
%
We conclude this note by recording the following result on finite index subgroups.
%
%
\begin{lem}
Let $G$ be a finitely generated subgroup and let $H\leq G$ be a finite index subgroup. Then $G$ has property FW if and only if $H$ has property FW.
\end{lem}
%
%
\begin{proof}
Since $H$ is a finite index subgroup of the finitely generated group $H$, it is itself finitely generated.
So let $S$ be a finite symmetric generating set for $H$ and let $\{g_1=1,\dots, g_n\}$ be a set of representatives of $G/H$.
Then $T=S\cup\{g_2^\pm,\dots, g_n^\pm\}$ is a finite symmetric generating set for $G$.

Suppose that $H$ has property FW and let $\Gamma$ be a Schreier graph of $G$ with respect to $T$.
For each vertex $x$ we define $\Gamma_x^H$ as the Schreier graph obtained from the action of $H$ on the $H$-orbit of $x$. Since $G$ acts transitively on the vertices of $\Gamma$, the number of $H$-orbits, and hence of graphs $\Gamma_x^H$, is bounded by $[G:H]$ and hence finite.
Moreover, $\Gamma$ is the union of the $\Gamma_x^H$ together with extra-edges coming from generators in $T\setminus S$.
\todo[inline]{Idée de la preuve: montrer que si $\Gamma_x^H$ et $\Gamma_y^H$ sont tous les deux infinis, alors dans $\Gamma$ on ne peut pas les déconnecter en enlevant un nombre finis de sommets. Le résultat suit de cela et du fait que les $\Gamma_x^H$ ont au plus $1$ bouts.}
%We claim that if $\Gamma_x^H$ and $\Gamma_y^H$ are infinite, they 
%Let $K$ be a finite set of vertices of $\Gamma$. By assumption, we know that for each vertex $x$, the graph  $\Gamma_x^H$ has at most one infinite connected component. We claim

Now, suppose that $H$ does not have property FW and let $\Delta=\Sch(H,L;S)$ be a Schreier graph of $H$ with at least two ends.
\todo[inline]{Idée de la preuve: regarder l'action induite de $G$ sur $\Delta^{G/H}$. On montre que c'est transitif et on a donc un graphe $\Gamma=\Sch(G,L';T)$. Ensuite, on prend $K$ qui sépare $\Delta$ en deux bouts et on montre que $K^{G/H}$ sépare $\Gamma$ en deux bouts. }
\end{proof}